# Simulator rule definition file for ITK Testbench
#  FHIR BaRS
#	Richard Robinson 14/10/2020
#	Simon Farrow 1/02/2022
#
BEGIN RESPONSES

#NEW
#Search
notFound_Response						TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/NotFound_Trigger.xml "400 Bad Request"

Operation_Outcome_400					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_401					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_401.xml "401 Unauthorized"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_404					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_404.xml "404 Not Found"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_405					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_405.xml "405 Method Not Allowed"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Allow : "GET, POST"Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_408					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_408.xml "408 Request Timeout"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_409					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409.xml "409 Conflict" WITH_HTTP_HEADERS (  Date : "__RFC822TIMESTAMP__" X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_422					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_422.xml "422 Unprocessable Entity"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_429					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_429.xml "429 Too Many Requests"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_500					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_500.xml "500 Internal Server Error"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_501					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_501.xml "501 Not Implemented"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Operation_Outcome_503					TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_503.xml "503 Service Unavailable"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

SearchSlots_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
SearchSlots_HappyPath_No_Includes_Response		TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_No_Includes_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
SearchSlots_HappyPath_FreeBusy_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_FreeBusy_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
SearchSlots_HappyPath_FreeBusy_BusyOnly_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_FreeBusy_BusyOnly_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
SearchSlots_HappyPath_NoSlots_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_NoSlots_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
SearchSlots_HappyPath_OnlySlots_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/SearchSlots_HappyPath_OnlySlots_Response.xml 200  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

Capability_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/CapabilityStatement_Response.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Capability_HappyPath_BookingAndReferral_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_Capability_Statement-Booking_and_Referral_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Capability_HappyPath_ReferralReceiver_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_Capability_Statement-Referral_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Capability_HappyPath_BookingAndReferralSender_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_Capability_Statement-Booking_and_Referral_Sender.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Capability_HappyPath_ValidationReceiver_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_Capability_Statement-Validation_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
Capability_HappyPath_ValidationSender_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_Capability_Statement-Validation_Sender.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ValidationRequest_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Validation/999_to_111_ValidationRequest_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ValidationRequest_HappyPath_for_408_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Validation/999_to_111_ValidationRequest_for_408_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ValidationRequest_HappyPath_for_501_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Validation/999_to_111_ValidationRequest_for_501_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ReferralRequest_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
ReferralRequest_HappyPath_for_405_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_for_405_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
ReferralRequest_HappyPath_for_429_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_for_429_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
ReferralRequest_HappyPath_for_503_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_for_503_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

#Numbers at the end of these PATIENT9707606312 responses refer to the matrix in the order _X_Y
ReferralRequest_Operation_Outcome_1_3	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400_9707606312_booking_not_exists.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 
ReferralRequest_HappyPath_Response_2_3	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "ReferralCreated"
ReferralRequest_Operation_Outcome_3_3	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409_9707606312_referral_already_exists.xml "409 Conflict"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "ReferralCreated"

ReferralRequest_Operation_Outcome_1_4	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400_9707606312_booking_not_exists.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 
ReferralRequest_Operation_Outcome_2_4	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409_9707606312_referral_not_linked.xml "409 Conflict"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "AppointmentBooked"
ReferralRequest_Operation_Outcome_3_4	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409_9707606312_referral_already_exists.xml "409 Conflict"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "ReferralCreated"

ReferralRequest_Operation_Outcome_1_5	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400_9707606312_referral_not_exists.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 
ReferralRequest_Operation_Outcome_2_5	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400_9707606312_referral_not_exists.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "AppointmentBooked"
ReferralRequest_HappyPath_Response_3_5	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralRequest_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "AppointmentBooked"

BookingRequest_HappyPath_Response_1_1	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/BookingRequest_9707606312_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "AppointmentBooked"
BookingRequest_Operation_Outcome_2_1	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409_9707606312_booking_already_exists.xml "409 Conflict"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "AppointmentBooked"
BookingRequest_Operation_Outcome_3_1	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_409_9707606312_booking_already_exists.xml "409 Conflict"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = "ReferralCreated"

BookingRequest_Operation_Outcome_1_2	TKW_ROOT/config/FHIR_BaRS/simulator_config/operation_outcomes/operation_outcome_400_9707606312_booking_not_exists.xml "400 Bad Request"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 
BookingRequest_HappyPath_Response_2_2	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/BookingRequest_9707606312_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 
BookingRequest_HappyPath_Response_3_2	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/BookingRequest_9707606312_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" ) $111_TO_ED_Variable = 

BookingRequest_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/BookingRequest_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
BookingRequest_HappyPath_for_501_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/BookingRequest_for_501_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ValidationResponse_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Validation/999_to_111_ValidationResponse_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ReferralResponse_HappyPath_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/ReferralResponse_Response.xml "200 OK"  WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ValidationServiceRequest_HappyPath_Response TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Validation/999_to_CAS_Validation_ServiceRequest_Response.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

ReferralServiceRequest_HappyPath_Response TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Referral/Referral_ServiceRequest_Response.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

BookingAppointment_HappyPath_Response TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_Booking/Booking_Appointment_Response.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )

MessageDefinition_HappyPath_Response TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/MessageDefinition.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
MessageDefinition_HappyPath_BookingAndReferral_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_MessageDefinition-Booking_and_Referral_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
MessageDefinition_HappyPath_ReferralReceiver_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_MessageDefinition-Referral_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
MessageDefinition_HappyPath_BookingAndReferralSender_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_MessageDefinition-Booking_and_Referral_Sender.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
MessageDefinition_HappyPath_ValidationReceiver_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_MessageDefinition-Validation_Receiver.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )
MessageDefinition_HappyPath_ValidationSender_Response	TKW_ROOT/config/FHIR_BaRS/simulator_config/BaRS_MessageDefinition/BaRS_MessageDefinition-Validation_Sender.xml "200 OK" WITH_HTTP_HEADERS ( X-Request-Id : "__XREQID_ECHO__" X-Correlation-Id : "__XCORRID_ECHO__" Date : "__RFC822TIMESTAMP__" )


do_process	NONE	0
END RESPONSES

BEGIN SUBSTITUTIONS
__MESSAGEID__	uuid
__VERSIONID__	uuid
__UUID1__	uuid
__UUID2__	uuid
__UUID3__	uuid
__UUID4__	uuid
__UUID5__	uuid
__UUID6__	uuid
__UUID7__	uuid
__UUID8__	uuid
__UUID9__	uuid
__TIMESTAMP__	ISO8601datetime
__XREQID__	uuid
__XCORRID__ reg_exp http_header X-Request-ID "." "$0"
__XREQID_ECHO__	reg_exp http_header X-Request-Id "." "$0"
__XCORRID_ECHO__ reg_exp http_header X-Correlation-Id "." "$0"
__MY_ODS__ Literal TKWODS
__RFC822TIMESTAMP__	RFC822datetime
__TOMORROW__ Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.FormattedTimeSubstitution "yyyy-MM-dd Europe/London 1 0"
__YESTERDAY__ Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.FormattedTimeSubstitution "yyyy-MM-dd Europe/London -1 0"
__DAY_AFTER_TOMORROW__ Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.FormattedTimeSubstitution "yyyy-MM-dd Europe/London 2 0"
__SLOT_START_TIME__	Xpath //fhir:Appointment/fhir:contained/fhir:Slot/fhir:start/@value
__SLOT_END_TIME__	Xpath //fhir:Appointment/fhir:contained/fhir:Slot/fhir:end/@value
__START_TIME__	Xpath //fhir:Appointment/fhir:start/@value
__END_TIME__	Xpath //fhir:Appointment/fhir:end/@value
__CREATED_TIME__	Xpath //fhir:Appointment/fhir:created/@value
__SLOT_ID__	Xpath //fhir:Appointment/fhir:contained/fhir:Slot/fhir:id/@value
__SLOT_VALUE__	Xpath //fhir:Appointment/fhir:contained/fhir:Slot/fhir:identifier/fhir:value/@value
__SLOT_SCHED_REF__	Xpath //fhir:Appointment/fhir:contained/fhir:Slot/fhir:schedule/fhir:reference/@value
__DOC_REF__	Xpath //fhir:Appointment/fhir:contained/fhir:DocumentReference/fhir:id/@value
__DOC_REF_IDENTIFIER__	Xpath //fhir:Appointment/fhir:contained/fhir:DocumentReference/fhir:identifier/fhir:value/@value
# needs to be html escaped for full url on response
__FULL_CONTEXT_PATH__ reg_exp context_path "&" "&amp;" ALL
__HOST__ reg_exp http_header Host "." "$0"
__APPOINTMENT_ID__	reg_exp context_path "^.*/R4/Appointment/(([0-9]|[a-f]){8}-([0-9]|[a-f]){4}-([0-9]|[a-f]){4}-([0-9]|[a-f]){4}-([0-9]|[a-f]){12}).*$" "$1"
__DOCUMENT_REF_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "//fhir:Appointment/fhir:contained[fhir:DocumentReference]"
__SLOT_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "//fhir:Appointment/fhir:contained[fhir:Slot]"
__PATIENT_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "//fhir:Appointment/fhir:contained[fhir:Patient]"
__SUPPORTING_INFO_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "//fhir:Appointment/fhir:supportingInformation"
__SLOT_REF_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Appointment/fhir:slot"
__PARTICIPANT_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Appointment/fhir:participant"
__DESCRIPTION_VALUE__	Xpath //fhir:Appointment/fhir:description/@value
__VALIDATIONBUNDLEREQUEST_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/validation_bundle_insert_uuid_id.xsl servicerequest_uuid 0b42eac3-0175-43c8-bbab-efaa8ca31ccf"
__VALIDATIONBUNDLEREQUEST_FOR_408_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/validation_bundle_insert_uuid_id.xsl servicerequest_uuid 9e595424-9d67-45db-9a90-03259653cd37"
__VALIDATIONBUNDLEREQUEST_FOR_501_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/validation_bundle_insert_uuid_id.xsl servicerequest_uuid c337e8d8-fd5b-4a13-a8e4-0f6f4ac1bb1a"
__REFERRALBUNDLEREQUEST_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/referral_bundle_insert_uuid_id.xsl servicerequest_uuid 79120f41-a431-4f08-bcc5-1e67006fcae0"
__REFERRALBUNDLEREQUEST_FOR_405_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/referral_bundle_insert_uuid_id.xsl servicerequest_uuid 61215702-0049-4d76-9807-2123f0a6ca15"
__REFERRALBUNDLEREQUEST_FOR_429_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/referral_bundle_insert_uuid_id.xsl servicerequest_uuid 9d280ad9-6dda-46d2-a75e-f5b47b2f4e87"
__REFERRALBUNDLEREQUEST_FOR_503_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/referral_bundle_insert_uuid_id.xsl servicerequest_uuid 4d65ddaa-4d09-41cd-87c9-aeb9c0c96352"
__BOOKINGBUNDLEREQUEST_NODE__			Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/booking_bundle_insert_uuid_id.xsl appointment_uuid ce1c4ced-2a84-4198-9982-9caf894d0bb7"
__BOOKINGBUNDLEREQUEST_FOR_501_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/booking_bundle_insert_uuid_id.xsl appointment_uuid 0d440c22-7f25-4c6c-905d-2213d197d02a"
__BOOKINGBUNDLEREQUEST9707606312_NODE__			Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle TKW_ROOT/config/FHIR_BaRS/simulator_config/transforms/booking_bundle_insert_uuid_id.xsl appointment_uuid 9a8df080-bfbc-457f-b30f-664bba7760a4"
__BUNDLERESPONSE_NODE__	Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.XmlFragmentSubstitution "/fhir:Bundle"

#session id added for the stateful handling
SESSION_ID jsonpath http_header b64 NHSD-End-User-Organisation $.identifier[0].value
END SUBSTITUTIONS

# all the "match/contains" rules apply to the content by default to use eg the context path it must be specified as context_path
BEGIN EXPRESSIONS

FREEONLY						context_path matches ^.*&status=free&.*$|^.*&status=free$
FREEANDBUSY						context_path matches ^.*&status=free%2Cbusy&.*$|^.*&status=free%2Cbusy$|^.*&status=busy%2Cfree&.*$|^.*&status=busy%2Cfree$
HEALTHCARESERVICE_MISSING		context_path notcontains Schedule.actor%3AHealthcareService
SLOT_MISSING					xpathnotmatches //fhir:Appointment/fhir:contained/fhir:Slot/fhir:id/@value ^.+$
X-Request-ID_MISSING		http_header X-Request-ID notmatches ^.+$

#PreExistingServer expresions
EMPTY_CONTENT					matches ^$
# must be before parameters check since conversion from json wont happen IF content-type is wrong
INVALID_CONTENT_TYPE			http_header content-type matches ^.*(text.*|application/[a-z]+[^+]*)$
#
#http header checks
#
EMPTY_ACCEPT					http_header accept notmatches ^.+$
INVALID_ACCEPT					http_header accept notmatches ^.*application/fhir\+(xml|json).*$
#


#CREATED_RANGE_VALID Class uk.nhs.digital.mait.tkwx.tk.internalservices.rules.ValidUrlEncodingExpression context_path "" ""

#NHS 111 UEC Booking

#CONTEXT PATH CHECKS
SLOT						context_path matches ^.*/R4/Slot.*$
METADATA					context_path matches ^.*/R4/metadata.*$
APPOINTMENT					context_path matches ^.*/R4/Appointment.*$
SERVICEREQUEST				context_path matches ^.*/R4/ServiceRequest.*$
MESSAGEDEFINITION			context_path matches ^.*/R4/MessageDefinition\?context=.*$
MESSAGEDEFINITION401			context_path matches ^.*/R4/MessageDefinition\?context=FAIL0401.*$
MESSAGEDEFINITION404			context_path matches ^.*/R4/MessageDefinition\?context=FAIL0404.*$
INCLUDES						context_path matches ^.*_include.*$

VALIDATIONSERVICEREQUEST001				context_path matches ^.*/R4/ServiceRequest/0b42eac3-0175-43c8-bbab-efaa8ca31ccf.*$
VALIDATIONSERVICEREQUEST408				context_path matches ^.*/R4/ServiceRequest/9e595424-9d67-45db-9a90-03259653cd37.*$
VALIDATIONSERVICEREQUEST501				context_path matches ^.*/R4/ServiceRequest/c337e8d8-fd5b-4a13-a8e4-0f6f4ac1bb1a.*$

REFERRALSERVICEREQUEST001				context_path matches ^.*/R4/ServiceRequest/79120f41-a431-4f08-bcc5-1e67006fcae0.*$
REFERRALSERVICEREQUEST405				context_path matches ^.*/R4/ServiceRequest/61215702-0049-4d76-9807-2123f0a6ca15.*$
REFERRALSERVICEREQUEST429				context_path matches ^.*/R4/ServiceRequest/9d280ad9-6dda-46d2-a75e-f5b47b2f4e87.*$
REFERRALSERVICEREQUEST503				context_path matches ^.*/R4/ServiceRequest/4d65ddaa-4d09-41cd-87c9-aeb9c0c96352.*$

BOOKINGAPPOINTMENT001					context_path matches ^.*/R4/Appointment/ce1c4ced-2a84-4198-9982-9caf894d0bb7.*$
BOOKINGAPPOINTMENT501				context_path matches ^.*/R4/Appointment/0d440c22-7f25-4c6c-905d-2213d197d02a.*$

#HappyPath Free and Free & Busy	2000072489
#HappyPath Free & Busy (Busy Only)	2000071234
#HappyPath NoSlots 			2000073917
#HappyPath Only Slots			1503499715
#HTTP 408 				2000081230
HEALTHCARESERVICE2000072489		context_path matches ^.*Schedule.actor%3AHealthcareService=2000072489.*$
HEALTHCARESERVICE2000071234		context_path matches ^.*Schedule.actor%3AHealthcareService=2000071234.*$
HEALTHCARESERVICE2000073917		context_path matches ^.*Schedule.actor%3AHealthcareService=2000073917.*$
HEALTHCARESERVICE1503499715		context_path matches ^.*Schedule.actor%3AHealthcareService=1503499715.*$
HEALTHCARESERVICE2000081230		context_path matches ^.*Schedule.actor%3AHealthcareService=2000081230.*$
HEALTHCARESERVICE2000011147		context_path matches ^.*Schedule.actor%3AHealthcareService=2000011147.*$

DOSID2000011147 http_header b64 NHSD-Target-Identifier jsonpathequals $.value 2000011147
DOSID2000093816 http_header b64 NHSD-Target-Identifier jsonpathequals $.value 2000093816
DOSID2000076289 http_header b64 NHSD-Target-Identifier jsonpathequals $.value 2000076289
DOSID2000003366 http_header b64 NHSD-Target-Identifier jsonpathequals $.value 2000003366
DOSID1374839566 http_header b64 NHSD-Target-Identifier jsonpathequals $.value 1374839566

CONTEXT2000011147 context_path matches ^.*/R4/MessageDefinition\?context=2000011147$
CONTEXT2000093816 context_path matches ^.*/R4/MessageDefinition\?context=2000093816$
CONTEXT2000076289 context_path matches ^.*/R4/MessageDefinition\?context=2000076289$
CONTEXT2000003366 context_path matches ^.*/R4/MessageDefinition\?context=2000003366$
CONTEXT1374839566 context_path matches ^.*/R4/MessageDefinition\?context=1374839566$

#Service Request Category
SR_CATEGORY_VALIDATION	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:category/fhir:coding/fhir:code/@value validation
SR_CATEGORY_REFERRAL	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:category/fhir:coding/fhir:code/@value referral

SR_STATUS_ACTIVE	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:status/@value active
SR_STATUS_REVOKED	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:status/@value revoked
SR_STATUS_ENTERED-IN-ERROR	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:status/@value entered-in-error
SR_STATUS_COMPLETED	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:status/@value completed

APPOINTMENT_STATUS_BOOKED xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Appointment/fhir:status/@value booked
APPOINTMENT_STATUS_CANCELLED xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Appointment/fhir:status/@value cancelled

# There are 3 slots returned by the simulataor in SFFS
#SLOT 1 = da83ae28-46f0-4aad-9c54-dcad462cafcb
#SLOT 2 = c413ac51-df9b-45be-b413-d7548406a4fb - used for returning a response in preparation for the GET appointment responded with a 501
#SLOT 3 = 3f5dd95a-68a5-44ec-a234-3b28a24dad33 - busy slot

#NHS Number
#PATIENT001	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 3478526985
PATIENT400			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9618388816
PATIENT401			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9383924314
PATIENT404			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9976150288
PATIENT405			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9675199962
PATIENT408			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9945210394
PATIENT409			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9933902830
PATIENT422			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9818556143
PATIENT429			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9657562376
PATIENT500			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9853944189
PATIENT501			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9010223337
PATIENT503			xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9999960529

PATIENT9707606312	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9707606312

#PATIENTBOOKANDREF	xpathmatches //fhir:Bundle/fhir:entry/fhir:resource/fhir:Patient/fhir:identifier/fhir:value/@value 9054613556

#Stateful Variable setting
111_TO_ED_Variable_Initialised				$111_TO_ED_Variable matches ^$
111_TO_ED_Variable_Appointment_Booked		$111_TO_ED_Variable matches ^AppointmentBooked$
111_TO_ED_Variable_New_Referral_Created		$111_TO_ED_Variable matches ^ReferralCreated$


Booking_and_Referral_Linked xpathequals /fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:supportingInfo[starts-with(fhir:reference/@value,'Appointment/')]/fhir:reference/@value Appointment/9a8df080-bfbc-457f-b30f-664bba7760a4
Booking_and_Referral_MisLinked xpathexists /fhir:Bundle/fhir:entry/fhir:resource/fhir:ServiceRequest/fhir:supportingInfo[starts-with(fhir:reference/@value,'Appointment/')]/fhir:reference/@value 

passthrough	Always
dontpassthrough	Never
#
END EXPRESSIONS

# new BaRS 

BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:new:servicerequest-request
IF	SR_CATEGORY_VALIDATION	AND	PATIENT408	THEN	ValidationRequest_HappyPath_for_408_Response ELSE NEXT
IF	SR_CATEGORY_VALIDATION	AND	PATIENT501	THEN	ValidationRequest_HappyPath_for_501_Response ELSE NEXT
IF	SR_CATEGORY_VALIDATION	AND	PATIENT404	THEN	Operation_Outcome_404 ELSE NEXT
IF	SR_CATEGORY_VALIDATION	AND	PATIENT409	THEN	Operation_Outcome_409 ELSE NEXT
IF	SR_CATEGORY_VALIDATION	AND	PATIENT422	THEN	Operation_Outcome_422 ELSE NEXT
#Catch all Validation response
IF	SR_CATEGORY_VALIDATION					THEN	ValidationRequest_HappyPath_Response ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT400	THEN	Operation_Outcome_400 ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT405	THEN	ReferralRequest_HappyPath_for_405_Response ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT429	THEN	ReferralRequest_HappyPath_for_429_Response ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT500	THEN	Operation_Outcome_500 ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT503	THEN	ReferralRequest_HappyPath_for_503_Response ELSE NEXT

# 111toED - Referral Created / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312	AND 111_TO_ED_Variable_New_Referral_Created AND Booking_and_Referral_Linked THEN	ReferralRequest_Operation_Outcome_3_3 ELSE NEXT
# 111toED - Appointment Booked / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312	AND 111_TO_ED_Variable_Appointment_Booked AND Booking_and_Referral_Linked THEN	ReferralRequest_HappyPath_Response_2_3 ELSE NEXT
# 111toED - Initial / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312 AND Booking_and_Referral_Linked THEN	ReferralRequest_Operation_Outcome_1_3 ELSE NEXT

# 111toED - Referral Created / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312	AND 111_TO_ED_Variable_New_Referral_Created AND Booking_and_Referral_MisLinked THEN	ReferralRequest_Operation_Outcome_3_4 ELSE NEXT
# 111toED - Appointment Booked / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312	AND 111_TO_ED_Variable_Appointment_Booked AND Booking_and_Referral_MisLinked THEN	ReferralRequest_Operation_Outcome_2_4 ELSE NEXT
# 111toED - Initial / Create Linked Referral Request  matching correct state 
IF	SR_CATEGORY_REFERRAL	AND	PATIENT9707606312 AND Booking_and_Referral_MisLinked THEN	ReferralRequest_Operation_Outcome_1_4 ELSE NEXT

#Catch all Referral response
IF	SR_CATEGORY_REFERRAL					THEN	ReferralRequest_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE

BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:update:servicerequest-request
IF	SR_CATEGORY_VALIDATION	THEN	ValidationRequest_HappyPath_Response ELSE NEXT

# 111toED - Referral Created / Cancel Referral Request
IF	SR_CATEGORY_REFERRAL	AND PATIENT9707606312	AND 111_TO_ED_Variable_New_Referral_Created	THEN	ReferralRequest_HappyPath_Response_3_5 ELSE NEXT
# 111toED - Appointment Booked / Cancel Referral Request
IF	SR_CATEGORY_REFERRAL	AND PATIENT9707606312	AND 111_TO_ED_Variable_Appointment_Booked	THEN	ReferralRequest_Operation_Outcome_2_5 ELSE NEXT
# 111toED - Initial / Cancel Referral Request
IF	SR_CATEGORY_REFERRAL	AND PATIENT9707606312	THEN	ReferralRequest_Operation_Outcome_1_5 ELSE NEXT

#Catch all Referral response
IF	SR_CATEGORY_REFERRAL	THEN	ReferralRequest_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE


BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:new:servicerequest-response
IF	SR_CATEGORY_VALIDATION	AND	PATIENT401	THEN	Operation_Outcome_401 ELSE NEXT
IF	SR_CATEGORY_VALIDATION					THEN	ValidationResponse_HappyPath_Response ELSE NEXT
IF	SR_CATEGORY_REFERRAL	AND	PATIENT401	THEN	Operation_Outcome_401 ELSE NEXT
IF	SR_CATEGORY_REFERRAL					THEN	ReferralResponse_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE

BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:update:servicerequest-response
IF	SR_CATEGORY_VALIDATION	THEN	ValidationResponse_HappyPath_Response ELSE NEXT
IF	SR_CATEGORY_REFERRAL	THEN	ReferralResponse_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE

BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:new:booking-request
IF	PATIENT404	AND APPOINTMENT_STATUS_BOOKED		THEN	Operation_Outcome_404 ELSE NEXT
IF	PATIENT409	AND APPOINTMENT_STATUS_BOOKED		THEN	Operation_Outcome_409 ELSE NEXT
IF	PATIENT422	AND APPOINTMENT_STATUS_BOOKED		THEN	Operation_Outcome_422 ELSE NEXT
IF	PATIENT501	AND APPOINTMENT_STATUS_BOOKED		THEN	BookingRequest_HappyPath_for_501_Response ELSE NEXT
# 111toED - Referral Created / Make a Booking 
IF	APPOINTMENT_STATUS_BOOKED	AND PATIENT9707606312	AND 111_TO_ED_Variable_New_Referral_Created	THEN	BookingRequest_Operation_Outcome_3_1 ELSE NEXT
# 111toED - Appointment Booked / Make a Booking 
IF	APPOINTMENT_STATUS_BOOKED	AND PATIENT9707606312	AND 111_TO_ED_Variable_Appointment_Booked	THEN	BookingRequest_Operation_Outcome_2_1 ELSE NEXT
# 111toED - Initial / Make a Booking
IF	APPOINTMENT_STATUS_BOOKED	AND PATIENT9707606312	THEN	BookingRequest_HappyPath_Response_1_1 ELSE NEXT
#Catch all Booking response
IF	APPOINTMENT_STATUS_BOOKED	THEN	BookingRequest_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE

BEGIN RULE
POST+urn:nhs:names:services:bars:fhir:messaging:update:booking-request

# 111toED - Referral Created / Cancel a Booking 
IF	APPOINTMENT_STATUS_CANCELLED	AND PATIENT9707606312	AND 111_TO_ED_Variable_New_Referral_Created	THEN	BookingRequest_HappyPath_Response_3_2 ELSE NEXT
# 111toED - Appointment Booked / Cancel a Booking 
IF	APPOINTMENT_STATUS_CANCELLED	AND PATIENT9707606312	AND 111_TO_ED_Variable_Appointment_Booked	THEN	BookingRequest_HappyPath_Response_2_2 ELSE NEXT
# 111toED - Initial / Cancel a Booking 
IF	APPOINTMENT_STATUS_CANCELLED	AND PATIENT9707606312	THEN	BookingRequest_Operation_Outcome_1_2 ELSE NEXT

#Catch all Booking response
IF	APPOINTMENT_STATUS_CANCELLED	THEN	BookingRequest_HappyPath_Response ELSE NEXT
IF passthrough THEN notFound_Response
END RULE
BEGIN RULE
POST
IF passthrough THEN Operation_Outcome_405
END RULE

#=========================================================================================
# Http methods no interactionid

BEGIN RULE
GET
IF	METADATA	AND	DOSID2000011147										THEN	Capability_HappyPath_BookingAndReferral_Response	ELSE	NEXT
IF	METADATA	AND	DOSID2000076289										THEN	Capability_HappyPath_ReferralReceiver_Response		ELSE	NEXT
IF	METADATA	AND	DOSID2000093816										THEN	Capability_HappyPath_BookingAndReferralSender_Response		ELSE	NEXT
IF	METADATA	AND	DOSID2000003366										THEN	Capability_HappyPath_ValidationReceiver_Response	ELSE	NEXT
IF	METADATA	AND	DOSID1374839566										THEN	Capability_HappyPath_ValidationSender_Response		ELSE	NEXT
IF	METADATA															THEN	Capability_HappyPath_Response				ELSE	NEXT
IF	SERVICEREQUEST	AND	VALIDATIONSERVICEREQUEST001						THEN	ValidationServiceRequest_HappyPath_Response	ELSE	NEXT
IF	SERVICEREQUEST	AND	VALIDATIONSERVICEREQUEST408						THEN	Operation_Outcome_408						ELSE	NEXT
IF	SERVICEREQUEST	AND	VALIDATIONSERVICEREQUEST501						THEN	Operation_Outcome_501						ELSE	NEXT
IF	SERVICEREQUEST	AND	REFERRALSERVICEREQUEST001						THEN	ReferralServiceRequest_HappyPath_Response	ELSE	NEXT
IF	SERVICEREQUEST	AND	REFERRALSERVICEREQUEST405						THEN	Operation_Outcome_405						ELSE	NEXT
IF	SERVICEREQUEST	AND	REFERRALSERVICEREQUEST429						THEN	Operation_Outcome_429						ELSE	NEXT
IF	SERVICEREQUEST	AND	REFERRALSERVICEREQUEST503						THEN	Operation_Outcome_503						ELSE	NEXT
IF	APPOINTMENT	AND	BOOKINGAPPOINTMENT501								THEN	Operation_Outcome_501						ELSE	NEXT
IF	APPOINTMENT															THEN	BookingAppointment_HappyPath_Response		ELSE	NEXT
IF	MESSAGEDEFINITION401											THEN	Operation_Outcome_401							ELSE	NEXT
IF	MESSAGEDEFINITION404											THEN	Operation_Outcome_404							ELSE	NEXT
IF	MESSAGEDEFINITION	AND	CONTEXT2000011147							THEN	MessageDefinition_HappyPath_BookingAndReferral_Response		ELSE	NEXT
IF	MESSAGEDEFINITION	AND	CONTEXT2000076289							THEN	MessageDefinition_HappyPath_ReferralReceiver_Response		ELSE	NEXT
IF	MESSAGEDEFINITION	AND	CONTEXT2000093816							THEN	MessageDefinition_HappyPath_BookingAndReferralSender_Response	ELSE	NEXT
IF	MESSAGEDEFINITION	AND	CONTEXT2000003366							THEN	MessageDefinition_HappyPath_ValidationReceiver_Response		ELSE	NEXT
IF	MESSAGEDEFINITION	AND	CONTEXT1374839566							THEN	MessageDefinition_HappyPath_ValidationSender_Response		ELSE	NEXT
IF	MESSAGEDEFINITION											THEN	MessageDefinition_HappyPath_Response					ELSE	NEXT
IF 	SLOT	AND	HEALTHCARESERVICE_MISSING								THEN	Operation_Outcome_400						ELSE	NEXT
IF	SLOT	AND	FREEANDBUSY	AND	HEALTHCARESERVICE2000072489					THEN	SearchSlots_HappyPath_FreeBusy_Response			ELSE	NEXT
IF	SLOT	AND	FREEANDBUSY	AND	HEALTHCARESERVICE2000071234					THEN	SearchSlots_HappyPath_FreeBusy_BusyOnly_Response		ELSE	NEXT
IF	SLOT	AND	FREEONLY	AND	HEALTHCARESERVICE2000072489	AND INCLUDES			THEN	SearchSlots_HappyPath_Response				ELSE	NEXT
IF	SLOT	AND	FREEONLY	AND	HEALTHCARESERVICE2000072489					THEN	SearchSlots_HappyPath_No_Includes_Response			ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE2000072489								THEN	SearchSlots_HappyPath_Response				ELSE	NEXT
IF	SLOT	AND	FREEANDBUSY	AND	HEALTHCARESERVICE2000011147					THEN	SearchSlots_HappyPath_FreeBusy_Response			ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE2000011147								THEN	SearchSlots_HappyPath_Response				ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE2000071234								THEN	SearchSlots_HappyPath_FreeBusy_BusyOnly_Response		ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE2000073917								THEN	SearchSlots_HappyPath_NoSlots_Response			ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE1503499715								THEN	SearchSlots_HappyPath_OnlySlots_Response			ELSE	NEXT
IF	SLOT	AND	HEALTHCARESERVICE2000081230								THEN	Operation_Outcome_408						ELSE	NEXT

IF passthrough THEN notFound_Response
END RULE


BEGIN RULE
PUT
IF passthrough THEN Operation_Outcome_405
END RULE

BEGIN RULE
DELETE
IF passthrough THEN Operation_Outcome_405
END RULE

BEGIN RULE
PATCH
IF passthrough THEN Operation_Outcome_405
END RULE

BEGIN RULE
OPTIONS
IF passthrough THEN Operation_Outcome_405
END RULE
#=========================================================================================
